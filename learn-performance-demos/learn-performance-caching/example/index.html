<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTTP ìºì‹± í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-section {
      border: 1px solid #ddd;
      border-radius: 6px;
      margin: 15px 0;
      padding: 15px;
    }
    .test-section h3 {
      margin-top: 0;
      color: #333;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #0056b3;
    }
    .update-btn {
      background: #28a745;
    }
    .update-btn:hover {
      background: #1e7e34;
    }
    .result {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 10px;
      margin: 10px 0;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
    }
    .status-200 { border-left: 4px solid #28a745; }
    .status-304 { border-left: 4px solid #ffc107; }
    .status-error { border-left: 4px solid #dc3545; }
    .explanation {
      background: #e7f3ff;
      border-left: 4px solid #007bff;
      padding: 10px;
      margin: 10px 0;
      font-style: italic;
    }
    .cache-info {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
    }
    input[type="text"] {
      width: 200px;
      padding: 8px;
      margin: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš€ HTTP ìºì‹± ë™ì‘ í…ŒìŠ¤íŠ¸</h1>
    <p>ê° ë²„íŠ¼ì„ ì—¬ëŸ¬ ë²ˆ í´ë¦­í•˜ì—¬ ìºì‹œ ë™ì‘ì„ í™•ì¸í•˜ì„¸ìš”. ê°œë°œì ë„êµ¬ì˜ Network íƒ­ë„ í•¨ê»˜ í™•ì¸í•˜ë©´ ë” ìì„¸í•œ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    
    <div class="cache-info">
      <strong>ğŸ’¡ í…ŒìŠ¤íŠ¸ íŒ:</strong>
      <ul>
        <li>ETag/Last-Modified í…ŒìŠ¤íŠ¸ëŠ” ì²« ìš”ì²­ í›„ ë‘ ë²ˆì§¸ë¶€í„° 304 ì‘ë‹µì´ ì˜µë‹ˆë‹¤</li>
        <li>max-age í…ŒìŠ¤íŠ¸ëŠ” 30ì´ˆ ë‚´ì—ëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì—†ì´ ìºì‹œì—ì„œ ì‘ë‹µí•©ë‹ˆë‹¤</li>
        <li>ë°ì´í„° ì—…ë°ì´íŠ¸ í›„ ETag/Last-Modifiedë¥¼ ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”</li>
      </ul>
    </div>
  </div>

  <div class="container">
    <h2>ë°ì´í„° ê´€ë¦¬</h2>
    <div class="test-section">
      <h3>ğŸ“ ë°ì´í„° ì—…ë°ì´íŠ¸</h3>
      <input type="text" id="updateContent" placeholder="ìƒˆë¡œìš´ ë‚´ìš© ì…ë ¥">
      <button class="update-btn" onclick="updateData()">ë°ì´í„° ì—…ë°ì´íŠ¸</button>
      <button onclick="getStatus()">í˜„ì¬ ìƒíƒœ í™•ì¸</button>
      <div id="statusResult" class="result" style="display: none;"></div>
    </div>
  </div>

  <div class="container">
    <h2>ìºì‹œ í…ŒìŠ¤íŠ¸</h2>
    
    <div class="test-section">
      <h3>ğŸš« no-store í…ŒìŠ¤íŠ¸</h3>
      <div class="explanation">
        Cache-Control: no-store - ë¸Œë¼ìš°ì €ê°€ ì‘ë‹µì„ ìºì‹œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë§¤ë²ˆ ì„œë²„ì—ì„œ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ë°›ìŠµë‹ˆë‹¤.
      </div>
      <button onclick="testNoStore()">no-store ìš”ì²­</button>
      <div id="noStoreResult" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
      <h3>ğŸ·ï¸ ETag í…ŒìŠ¤íŠ¸</h3>
      <div class="explanation">
        ETag ê¸°ë°˜ ì¡°ê±´ë¶€ ìš”ì²­ - ì²« ìš”ì²­ì—ì„œ ETagë¥¼ ë°›ê³ , ì´í›„ ìš”ì²­ì—ì„œ If-None-Match í—¤ë”ë¡œ ë³´ëƒ…ë‹ˆë‹¤. ë°ì´í„°ê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ìœ¼ë©´ 304 ì‘ë‹µì„ ë°›ìŠµë‹ˆë‹¤.
      </div>
      <button onclick="testETag()">ETag ìš”ì²­</button>
      <button onclick="resetETag()">ETag ì´ˆê¸°í™”</button>
      <div id="etagResult" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
      <h3>ğŸ“… Last-Modified í…ŒìŠ¤íŠ¸</h3>
      <div class="explanation">
        Last-Modified ê¸°ë°˜ ì¡°ê±´ë¶€ ìš”ì²­ - ì²« ìš”ì²­ì—ì„œ Last-Modifiedë¥¼ ë°›ê³ , ì´í›„ ìš”ì²­ì—ì„œ If-Modified-Since í—¤ë”ë¡œ ë³´ëƒ…ë‹ˆë‹¤. ìˆ˜ì • ì‹œê°„ì´ ê°™ìœ¼ë©´ 304 ì‘ë‹µì„ ë°›ìŠµë‹ˆë‹¤.
      </div>
      <button onclick="testLastModified()">Last-Modified ìš”ì²­</button>
      <button onclick="resetLastModified()">Last-Modified ì´ˆê¸°í™”</button>
      <div id="lastModifiedResult" class="result" style="display: none;"></div>
    </div>

    <div class="test-section">
      <h3>â° max-age í…ŒìŠ¤íŠ¸</h3>
      <div class="explanation">
        Cache-Control: max-age=30 - 30ì´ˆ ë™ì•ˆ ë¸Œë¼ìš°ì € ìºì‹œì—ì„œ ì§ì ‘ ì‘ë‹µí•©ë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </div>
      <button onclick="testMaxAge()">max-age ìš”ì²­</button>
      <div id="maxAgeResult" class="result" style="display: none;"></div>
    </div>
  </div>

  <script>
    // ìºì‹œëœ ê°’ë“¤
    let cachedETag = null;
    let cachedLastModified = null;
    let cachedETagData = null;
    let cachedLastModifiedData = null;

    // ê³µí†µ ì‘ë‹µ ì²˜ë¦¬ í•¨ìˆ˜
    async function handleResponse(url, options = {}, resultId, useCache = false) {
      const startTime = performance.now();
      
      try {
        const response = await fetch(url, options);
        const endTime = performance.now();
        const responseTime = Math.round(endTime - startTime);
        
        // í—¤ë” ìˆ˜ì§‘
        const headers = {};
        response.headers.forEach((value, key) => {
          headers[key] = value;
        });

        let data = null;
        let bodyText = '';
        
        if (response.status === 304) {
          bodyText = '(304 Not Modified - ìºì‹œëœ ë°ì´í„° ì‚¬ìš©)';
          if (useCache === 'etag' && cachedETagData) {
            data = cachedETagData;
          } else if (useCache === 'lastmodified' && cachedLastModifiedData) {
            data = cachedLastModifiedData;
          }
        } else {
          try {
            data = await response.json();
            bodyText = JSON.stringify(data, null, 2);
          } catch (e) {
            bodyText = '(ì‘ë‹µ ë³¸ë¬¸ì„ ì½ì„ ìˆ˜ ì—†ìŒ)';
          }
        }

        // ê²°ê³¼ í‘œì‹œ
        const resultDiv = document.getElementById(resultId);
        const statusClass = response.status === 200 ? 'status-200' : 
                          response.status === 304 ? 'status-304' : 'status-error';
        
        resultDiv.className = `result ${statusClass}`;
        resultDiv.style.display = 'block';
        resultDiv.textContent = 
          `Status: ${response.status} ${response.statusText}\n` +
          `Response Time: ${responseTime}ms\n` +
          `Headers:\n${JSON.stringify(headers, null, 2)}\n\n` +
          `Body:\n${bodyText}`;

        return { response, data, headers };
      } catch (error) {
        const resultDiv = document.getElementById(resultId);
        resultDiv.className = 'result status-error';
        resultDiv.style.display = 'block';
        resultDiv.textContent = `Error: ${error.message}`;
        throw error;
      }
    }

    // no-store í…ŒìŠ¤íŠ¸
    async function testNoStore() {
      await handleResponse('/api/no-store', {}, 'noStoreResult');
    }

    // ETag í…ŒìŠ¤íŠ¸
    async function testETag() {
      const headers = {};
      if (cachedETag) {
        headers['If-None-Match'] = cachedETag;
      }

      const result = await handleResponse('/api/etag', { headers }, 'etagResult', 'etag');
      
      // ETag ì €ì¥
      if (result.headers.etag) {
        cachedETag = result.headers.etag;
        if (result.data) {
          cachedETagData = result.data;
        }
      }
    }

    // Last-Modified í…ŒìŠ¤íŠ¸
    async function testLastModified() {
      const headers = {};
      if (cachedLastModified) {
        headers['If-Modified-Since'] = cachedLastModified;
      }

      const result = await handleResponse('/api/last-modified', { headers }, 'lastModifiedResult', 'lastmodified');
      
      // Last-Modified ì €ì¥
      if (result.headers['last-modified']) {
        cachedLastModified = result.headers['last-modified'];
        if (result.data) {
          cachedLastModifiedData = result.data;
        }
      }
    }

    // max-age í…ŒìŠ¤íŠ¸
    async function testMaxAge() {
      await handleResponse('/api/max-age', {}, 'maxAgeResult');
    }

    // ë°ì´í„° ì—…ë°ì´íŠ¸
    async function updateData() {
      const content = document.getElementById('updateContent').value;
      
      try {
        const response = await fetch('/api/update', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ content })
        });
        
        const data = await response.json();
        alert(`ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤! ë²„ì „: ${data.newData.version}`);
        
        // ìºì‹œ ì´ˆê¸°í™”
        resetETag();
        resetLastModified();
        
        document.getElementById('updateContent').value = '';
      } catch (error) {
        alert(`ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${error.message}`);
      }
    }

    // í˜„ì¬ ìƒíƒœ í™•ì¸
    async function getStatus() {
      await handleResponse('/api/status', {}, 'statusResult');
    }

    // ETag ìºì‹œ ì´ˆê¸°í™”
    function resetETag() {
      cachedETag = null;
      cachedETagData = null;
      console.log('ETag ìºì‹œ ì´ˆê¸°í™”ë¨');
    }

    // Last-Modified ìºì‹œ ì´ˆê¸°í™”
    function resetLastModified() {
      cachedLastModified = null;
      cachedLastModifiedData = null;
      console.log('Last-Modified ìºì‹œ ì´ˆê¸°í™”ë¨');
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ìƒíƒœ í™•ì¸
    window.addEventListener('load', () => {
      console.log('ğŸš€ HTTP ìºì‹± í…ŒìŠ¤íŠ¸ í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
      console.log('ê°œë°œì ë„êµ¬ì˜ Network íƒ­ì„ ì—´ì–´ì„œ ìš”ì²­/ì‘ë‹µì„ í™•ì¸í•˜ì„¸ìš”.');
    });
  </script>
</body>
</html> 